/**
 * exValidation
 *
 * @version      $Rev$
 * @author       nori (norimania@gmail.com)
 * @copyright    5509 (http://5509.me/)
 * @license      The MIT License
 * @link         http://5509.me/log/exvalidation
 *
 * $Date$
 */
var validationRules={};(function(h){var a=function(i,o){if(i.length>1){alert("You cannot select any forms ");}this.form=i;var n=this,o=this.conf=h.extend({errInsertPos:"body",err:null,ok:null,errFocus:false,errHoverHide:false,stepValidation:false,scrollToErr:true,scrollDuration:500,scrollAdjust:-10,errPosition:"absolute",errTipPos:"right",errTipCloseBtn:true,errTipCloseLabel:"Å~",errZIndex:500,errMsgPrefix:"* ",customSubmit:null,customListener:"blur keyup change focus",customBind:null,customGetErrHeight:null,firstValidate:false,inputs:'input:text,input:password,input:hidden,textarea,select,[class*="group"],[class*="radio"],[class*="checkbox"]',groupInputs:"input:text,input:password,input:checkbox,input:radio,select,textarea"},o||{});this.errFocus=function(s){if(!o.errFocus){return false;}d(s,o.errZIndex);};this.errFocusClear=function(){if(!o.errFocus){return false;}e(o.errZIndex);};if(g(o.customSubmit)){i.submit(function(){return false;});}h("input:checkbox,input:radio,input:button,input:submit,input:reset").click(function(){n.errFocusClear();});for(var p in o.rules){h("#"+p).addClass(o.rules[p]);}var j=h(i).attr("id")?"form_"+h(i).attr("id"):"form_"+f()*f();var m=h(o.inputs,i).filter(function(){return !h(this).parents().hasClass("group");}),q=b(),r="",l=function(u,t){var s=t?t:u;u.bind(o.customListener,function(){n.basicValidate(t?t:this,o.err,o.ok);n.errFocus("#err_"+s.attr("id"));}).blur(function(){n.errFocusClear();});};m.each(function(){var t=h(this),s=this.className,u=t.offset(),v=this.id;if(o.errTipPos=="right"){t.addClass("errPosRight");}if(s.match(q)){if(o.errInsertPos=="body"){h("body").append(n.generateErr(v,j));}else{t[o.errInsertPos](n.generateErr(v,j));}if(o.errHoverHide){h("#err_"+v).mouseenter(function(){h(this).fadeOut();});}if(o.errTipCloseBtn){h("#err_"+v).append(h("<span/>").addClass("formErrorClose").text(o.errTipCloseLabel).click(function(){h(this).parent().fadeOut();}));}if(o.errPosition=="absolute"){if(g(o.customGetErrHeight)){n.customGetErrHeight(v);}else{n.getErrHeight(v,o.errZIndex);}h(window).resize(function(){if(g(o.customGetErrHeight)){n.customGetErrHeight(v);}else{n.getErrHeight(v,o.errZIndex);}});}h("#err_"+v).hide();}});if(o.firstValidate){m.each(function(){if(h(this).hasClass("group")){var s=h(this);l(h(o.groupInputs,s),s);}else{var s=h(this);l(s);}});}this.laterCall=function(s){n.basicValidate(s,o.err,o.ok);};function k(t){if(o.firstValidation){m.unbind("blur keyup change click");o.firstValidate=false;}m.each(function(){var y=h(this);n.basicValidate(this,o.err,o.ok,true);if(y.hasClass("group")){l(h(o.groupInputs,y),y);}else{l(y);}});var w=h('.formError:visible[class*="'+j+'"]');if(w.length>0){if(o.scrollToErr){var x=h(w[0]).offset().top,v=h(w[0]),s=h.support.boxModel?navigator.appName.match(/Opera/)?"html":"html,body":"body";for(var u=0;u<w.length;u++){x=h(w[u]).offset().top<x?h(w[u]).offset().top:x;v=h(w[u]).offset().top<x?h(w[u]):v;}if(o.errPosition=="fixed"){x-=h("#"+v.attr("id").replace("err_","")).attr("offsetHeight");}h(s).animate({scrollTop:x+o.scrollAdjust},{easing:h.easing.easeInOutCirc?"easeInOutCirc":"swing",duration:o.scrollDuration});}else{return false;}}else{if(g(t)){t();}else{if(g(o.customSubmit)){o.customSubmit();return false;}else{}}}}i.submit(k);if(o.customBind){o.customBind.object.bind(o.customBind.listener,function(){k(o.customBind.callback);return false;});}return this;};a.prototype={generateErr:function(j,i){return['<div id="err_'+j+'" class="formError userformError '+i+" "+this.conf.errPosition+'">','<div class="msg formErrorContent"/>','<div class="formErrorArrow">','<div class="line10"/>','<div class="line9"/>','<div class="line8"/>','<div class="line7"/>','<div class="line6"/>','<div class="line5"/>','<div class="line4"/>','<div class="line3"/>','<div class="line2"/>','<div class="line1"/>',"</div>","</div>"].join("");},insertErrMsg:function(i,n,m,j){var k=h(".errMsg","#err_"+n),l=true;if(k.length>0){h.each(k,function(){if(h(this).hasClass(m)){l=false;}});}if(!l){return false;}h(".msg","#err_"+n).append(h("<span/>").addClass("errMsg").addClass(m).text(j));this.getErrHeight(n);},getErrHeight:function(o,n){if(this.conf.errPosition!="absolute"){return false;}var i=h("#"+o),l=i.is(":hidden")?i.next():i,m=l.offset(),k=l.hasClass("errPosRight")?m.left+l.attr("offsetWidth")-40:m.left-20,j=h("#err_"+o).css({position:"absolute",top:m.top-h("#err_"+o).attr("offsetHeight"),left:k});if(n){j.css("zIndex",n);}},basicValidate:function(r,k,q){var m=h(r).attr("class"),p=validationRules,j=h(r).attr("id"),n="",o=this;if(h(r).hasClass("group")){var l=h(o.conf.groupInputs,r);l.each(function(s){n+=h(this).val();if(m.match(/email/)&&s==0&&h(this).val().length>0){n+="@";}});}else{n=h(r).val();}var i={isError:false,failed:function(s,v){var u=p[v][0];if(v.match(/min/i)&&m.match(/min(\d+)/i)){u=RegExp.$1+u;}else{if(v.match(/max/i)&&m.match(/max(\d+)/i)){u=RegExp.$1+u;}}if(g(k)){k(s,j,o.conf.errMsgPrefix+u);}else{h(s).addClass("err");h("."+v,"#err_"+j).show();h("#err_"+j).fadeIn();o.insertErrMsg(s,j,v,o.conf.errMsgPrefix+u);o.getErrHeight(j);}this.isError=true;}};for(c in p){if(m.match(c)){if(typeof(p[c][1])!="function"){if(!n.match(p[c][1])){i.failed(r,c);}else{if(o.conf.stepValidation){if(h(".errMsg:visible","#err_"+j).length>1){h("."+c,"#err_"+j).hide();o.getErrHeight(j);}}}}else{if(!p[c][1](n,r)){i.failed(r,c);}else{if(o.conf.stepValidation){if(h(".errMsg:visible","#err_"+j).length>1){h("."+c,"#err_"+j).hide();o.getErrHeight(j);}}}}}}if(!i.isError){if(g(q)){q(r,j);}else{h(r).removeClass("err");h("#err_"+j).fadeOut();}}}};function b(){var i="";for(var j in validationRules){i+=j+"|";}i=i.replace(/\|$/,"");return new RegExp(i);}function e(i){h(".formError").removeClass("fadeOut").css("zIndex",i);}function d(j,i){h(".formError").removeClass("fadeOut").css("zIndex",i);h(".formError").not(j).addClass("fadeOut");h(j).css({zIndex:i+100});}function g(i){return i&&typeof i=="function";}function f(){return Math.floor(Math.random()*10)+1;}h.fn.exValidation=function(i){return new a(this,i);};if(!h.fn.validation){h.fn.validation=h.fn.exValidation;}})(jQuery);