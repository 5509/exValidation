/*!
 * exValidation
 *
 * @version   : 1.3.3
 * @author    : nori (norimania@gmail.com)
 * @copyright : 5509 (http://5509.me/)
 * @license   : The MIT License
 * @link      : http://5509.me/log/exvalidation
 * @modified  : 2012-04-09 16:59
 */(function(a,b,c){function e(){var b="";for(var c in a.exValidationRules)b+="(?:\\s+|^)"+c+"(?:\\s+|$)|";b+="(?:\\s+|^)chkmin\\d+(?:\\s+|$)|";b+="(?:\\s+|^)chkmax\\d+(?:\\s+|$)|";b=b.replace(/\|$/,"");return new RegExp(b)}function f(b){a(".formError").removeClass("fadeOut").css("zIndex",b)}function g(b,c){var d=a(".formError");d.removeClass("fadeOut").css("zIndex",c);d.not(b).addClass("fadeOut");a(b).css({zIndex:c+100})}function h(a){return a&&typeof a=="function"}function i(){return Math.floor(Math.random()*10)+1}a.exValidationRules=a.exValidationRules||{};var d=function(d,j){function r(b){if(j.firstValidate){o.unbind("blur keyup change click");j.firstValidate=!1}o.each(function(){var b=a(this);k.basicValidate(this,j.err,j.ok,!0);b.hasClass("chkgroup")?q(a(j.groupInputs,b),b):q(b)});var c=a(".formError:visible[class*='"+n+"']");if(c.length>0){h(j.customAddError)&&j.customAddError();if(j.scrollToErr){var d,e,f,g=a.support.boxModel?navigator.appName.indexOf("Opera")!==-1?"html":"html,body":"body";if(!j.customScrollAdjust){d=a(c[0]).offset().top;f=a(c[0]);for(var i=0,l=c.length;i<l;i++){e=a(c[i]);d=e.offset().top<d?e.offset().top:d;f=e.offset().top<d?e:f}j.errPosition==="fixed"&&(d-=a("#"+f.attr("id").replace("err_","")).get(0).offsetHeight)}else d=h(j.customScrollAdjust)?parseFloat(j.customScrollAdjust()):parseFloat(j.customScrollAdjust);a(g).animate({scrollTop:d+j.scrollAdjust},{easing:a.easing.easeInOutCirc?"easeInOutCirc":"swing",duration:j.scrollDuration})}return!1}if(h(j.customClearError)){var m=j.customClearError();if(!m)return!1}if(h(b)){b();return!1}if(h(j.customSubmit)){j.customSubmit();return!1}return!0}if(d.length>1){alert("You cannot select any forms");return!1}this.form=d;var k=this,l=a("body");j=this.conf=a.extend({errInsertPos:"body",err:null,ok:null,errFocus:!1,errHoverHide:!1,stepValidation:!1,scrollToErr:!0,scrollDuration:500,scrollAdjust:-10,customScrollAdjust:!1,errPosition:"absolute",errOpacity:c,errTipPos:"right",errTipCloseBtn:!0,errTipCloseLabel:"Ã—",errZIndex:500,errMsgPrefix:"* ",customAddError:null,customClearError:null,customSubmit:null,customListener:"blur keyup change focus",customBind:null,customGetErrHeight:null,firstValidate:!1,inputs:["input:text","input:password","input:hidden","input:file","textarea","select","input[type=email]","input[type=url]","input[type=tel]","input[type=date]","input[type=datetime]","input[type=month]","input[type=week]","input[type=time]","input[type=datetime-local]","input[type=number]","input[type=range]","input[type=color]","[class*=group]","[class*=radio]","[class*=checkbox]"],groupInputs:["input:text","input:password","input:checkbox","input:radio","input[type=email]","input[type=url]","input[type=tel]","input[type=date]","input[type=datetime]","input[type=month]","input[type=week]","input[type=time]","input[type=datetime-local]","input[type=number]","input[type=range]","input[type=color]","select","textarea"]},j);j.inputs=j.inputs.join(",");j.groupInputs=j.groupInputs.join(",");this.errFocus=function(a){if(!j.errFocus)return!1;g(a,j.errZIndex)};this.errFocusClear=function(){if(!j.errFocus)return!1;f(j.errZIndex)};h(j.customSubmit)&&d.submit(function(){return!1});d.find("input:checkbox,input:radio,input:button,input:submit,input:reset").click(function(){k.errFocusClear()});for(var m in j.rules)a("#"+m).addClass(j.rules[m]);var n=d.attr("id")?"form_"+d.attr("id"):"form_"+i()*i(),o=a(j.inputs,d).filter(function(){return!a(this).parents().hasClass("chkgroup")}),p=e(),q=function(a,b){var c=b?b:a;a.bind(j.customListener,function(){k.basicValidate(b?b:this,j.err,j.ok);k.errFocus("#err_"+c.attr("id"))}).blur(function(){k.errFocusClear()})};o.each(function(){var d=a(this),e=this.className,f=this.id,g=c,i=c,m=c;j.errTipPos==="right"&&d.addClass("errPosRight");if(p.test(e)){if(j.errInsertPos==="body")l.append(k.generateErr(f,n));else{d[j.errInsertPos](k.generateErr(f,n));d.addClass(j.errInsertPos)}j.errHoverHide&&a("#err_"+f).mouseenter(function(){a(this).fadeOut()});j.errTipCloseBtn&&a("#err_"+f).append(a("<span></span>").addClass("formErrorClose").text(j.errTipCloseLabel).click(function(){a(this).parent().fadeOut()}));j.errOpacity!==c&&a("#err_"+f).children().css("opacity",j.errOpacity);if(j.errPosition==="absolute"){h(j.customGetErrHeight)?k.customGetErrHeight(f):k.getErrHeight(f,j.errZIndex);a(b).resize(function(){h(j.customGetErrHeight)?k.customGetErrHeight(f):k.getErrHeight(f,j.errZIndex)})}a("#err_"+f).hide()}});o.each(function(){var b=a(this),d=c,e=c,f=c;if(this.className.match(/chktoggle_([^_]+)_([^ ]+)/)){d="#"+RegExp.$1;e="#"+RegExp.$2;f=a(e).removeClass("chkrequired");a(d).click(function(){console.log(f);this.checked?f.addClass("chkrequired"):f.removeClass("chkrequired");k.laterCall(f)})}if(!j.firstValidate)return;b.hasClass("chkgroup")?q(a(j.groupInputs,b),b):q(b)});this.laterCall=function(a){k.basicValidate(a,j.err,j.ok)};d.submit(r);j.customBind&&j.customBind.object.bind(j.customBind.listener,function(){r(j.customBind.callback);return!1});return this};d.prototype={generateErr:function(a,b){return['<div id="err_'+a+'" class="formError userformError'+" "+b+" "+this.conf.errPosition+'">','<div class="formErrorMsg formErrorContent"></div>','<div class="formErrorArrow">','<div class="line10"></div>','<div class="line9"></div>','<div class="line8"></div>','<div class="line7"></div>','<div class="line6"></div>','<div class="line5"></div>','<div class="line4"></div>','<div class="line3"></div>','<div class="line2"></div>','<div class="line1"></div>',"</div>","</div>"].join("")},insertErrMsg:function(b,c,d,e){var f=a(".errMsg","#err_"+c),g=!0;f.length>0&&a.each(f,function(){a(this).hasClass(d)&&(g=!1)});if(!g)return!1;a(".formErrorMsg","#err_"+c).append(a("<span></span>").addClass("errMsg").addClass(d).text(e));this.getErrHeight(c)},getErrHeight:function(b,c){if(this.conf.errPosition!=="absolute")return!1;var d=a("#"+b),e=a("#err_"+b),f=d.is(":hidden")?d.next():d,g=f.offset();if(!!g){var h=f.hasClass("errPosRight")?g.left+f.get(0).offsetWidth-40:g.left-20;e.css({position:"absolute",top:g.top-e.get(0).offsetHeight,left:h})}c&&e.css("zIndex",c)},basicValidate:function(b,c,d){var e=a(b),f=e.attr("class"),g=a.exValidationRules,i=e.attr("id"),j="",k=this;if(e.hasClass("chkgroup")){var l=a(k.conf.groupInputs,b);l.each(function(b){var c=a(this);j+=c.val();f.indexOf("chkemail")!==-1&&b==0&&c.val().length>0&&(j+="@")})}else j=e.val();var m={isError:!1,failed:function(b,d){var j=g[d][0];d.match(/chkmin/i)&&f.match(/chkmin(\d+)/i)?j=RegExp.$1+j:d.match(/chkmax/i)&&f.match(/chkmax(\d+)/i)&&(j=RegExp.$1+j);if(h(c))c(b,i,k.conf.errMsgPrefix+j);else{e.addClass("err");a("."+d,"#err_"+i).show();a("#err_"+i).stop(!0,!0).fadeIn();k.insertErrMsg(b,i,d,k.conf.errMsgPrefix+j);k.getErrHeight(i)}this.isError=!0}},n;for(n in g){if(!f)continue;if(e.hasClass(n)||n==="chkmin"&&f.match(/(?:\s+|^)chkmin\d+(?:\s+|$)/)||n==="chkmax"&&f.match(/(?:\s+|^)chkmax\d+(?:\s+|$)/)||f.indexOf(n)!==-1&&f.indexOf("chkretype")!==-1)if(typeof g[n][1]!="function"){if(!j.match(g[n][1]))m.failed(b,n);else if(k.conf.stepValidation&&a(".errMsg:visible","#err_"+i).length>1){a("."+n,"#err_"+i).hide();k.getErrHeight(i)}}else if(!g[n][1](j,b))m.failed(b,n);else if(k.conf.stepValidation&&a(".errMsg:visible","#err_"+i).length>1){a("."+n,"#err_"+i).hide();k.getErrHeight(i)}}if(!m.isError)if(h(d))d(b,i);else{e.removeClass("err");a("#err_"+i).stop(!0,!0).fadeOut()}}};a.fn.exValidation=function(a){return new d(this,a)};a.fn.validation||(a.fn.validation=a.fn.exValidation)})(jQuery,this);